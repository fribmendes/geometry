{"version":1,"ops":[{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1547140231,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ1MzE3NTU4MQ==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-453175581"},"message":"I removed the `local` from that function, and quotes some things. Care to test again? Also I'm going to have to figure out how to test on different zsh versions.","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1547142413,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ1MzE4ODY3MQ==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-453188671"},"message":"I added a Dockerfile to test zsh-5.0.0","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1550944074,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ2NjY3Mjk0Ng==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-466672946"},"message":"are you still getting this issue?","files":null},{"type":3,"author":{"id":"33950328296720bc91f2399d6dc2e05aaa877cba"},"timestamp":1550956087,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ2NjY5NTM3NQ==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-466695375"},"message":"Yes :)","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1558992463,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ5NjMwODUzNA==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-496308534"},"message":"I made a Dockerfile using zsh-users-5.0.0 but I get a different error","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1558994039,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ5NjMxMTQ0OA==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-496311448"},"message":"SO I'm having trouble reproducing this issue on the latest mnml branch. I made a Dockerfile that should provide a common environment to test for the issue, but I'm at a loss of how to debug.","files":null},{"type":6,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1558994039,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDIyNzg2NDMwNA=="},"target":"5b44170b11f7329924b0bee6dde2071774231790213e915a0bdfdb0c26490af5","message":"So I'm having trouble reproducing this issue on the latest mnml branch. I made a Dockerfile that should provide a common environment to test for the issue, but I'm at a loss of how to debug.","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1558994650,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ5NjMxMjUwMw==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-496312503"},"message":"There was a bugfix branch from a few years ago, that changed instances of `local _ctx_plugins=()` to twoliners, `local _ctx_plugins; _ctx_plugins=()`. Should investigate those fixes as well.","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1566382099,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUyMzM5MTM1MA==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-523391350"},"message":"Is this still a problem?","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1566384128,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUyMzQwMjI3MA==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-523402270"},"message":"Running in the dockerfile, this seems to be fixed.","files":null},{"type":4,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1566384128,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MjU3MjYxODE5MQ=="},"status":2},{"type":3,"author":{"id":"33950328296720bc91f2399d6dc2e05aaa877cba"},"timestamp":1566438537,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUyMzcxMzE0Ng==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-523713146"},"message":"I've just checked, bpth gemetry and mnml doesn't yield this error","files":null},{"type":6,"author":{"id":"33950328296720bc91f2399d6dc2e05aaa877cba"},"timestamp":1566438537,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDI2NzA5Nzg4Mg=="},"target":"476c6706a4a1a1bdb9ded55627fc21d2dacb4dc4104d2ab57aa70d64138bd53f","message":"I've just checked, both geometry and mnml doesn't yield this error","files":null},{"type":3,"author":{"id":"33950328296720bc91f2399d6dc2e05aaa877cba"},"timestamp":1566439166,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUyMzcxNTIyNw==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-523715227"},"message":"Too early a success call – I've just got:\n\n```\nmnml::wrap:local:7: not valid in this context: %F{red}3%f$MNML_GIT_SEPARATOR%F{red}\\u2b21%f\nmnml::wrap:local:7: not valid in this context: %F{red}3%f$MNML_GIT_SEPARATOR%F{red}\\u2b21%f\nmnml::wrap:local:7: not valid in this context: %F{red}3%f$MNML_GIT_SEPARATOR%F{red}\\u2b21%f\n```\nand it seems to come from zsh-5.7.1: \n![mnml-error](https://user-images.githubusercontent.com/6049288/63480170-30d3ce00-c491-11e9-8bee-4c9e48c07d97.png)","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1566463505,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUyMzgxMTE3OQ==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-523811179"},"message":"Can you get that error using the dockerfile? Because I tried 5.7.1 and it seems to be working...","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1566463518,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUyMzgxMTI2OQ==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-523811269"},"message":"Also might have to do with some quoting https://github.com/zsh-users/zsh-autosuggestions/issues/127","files":null},{"type":4,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1566463519,"metadata":{"github-id":"MDEzOlJlb3BlbmVkRXZlbnQyNTc1Njg5Mjc1"},"status":1},{"type":3,"author":{"id":"33950328296720bc91f2399d6dc2e05aaa877cba"},"timestamp":1567270260,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUyNjg0NjMyMQ==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-526846321"},"message":"So the `local var=$( ... )` should be changed to a quoted version `local var=\"$( ... )\"`. I did a quick search and found a few of such cases:\n\n```\n ▲ .zplugin/plugins/geometry-zsh---geometry ack local.\\*'\\$\\('         mnml 9d :: ⬡\nfunctions/geometry_node.zsh\n14:    local packager_version=\"$($package_manager --version 2\u003e/dev/null)\"\n15:    local node_version=\"$(node -v 2\u003e/dev/null)\"\n\nfunctions/geometry_rustup.zsh\n12:    local toolchain=\"$(rustup show | grep 'stable|beta|nightly' | head -n 1 |  cut -d '-' -f 1 | tr -d '\\n' 2\u003e /dev/null)\"\n\nfunctions/geometry_kube.zsh\n13:  local context=\"$(kubectl config current-context 2\u003e /dev/null)\"\n14:  local namespace=\"$(kubectl config view -o \"jsonpath={.contexts[?(@.name==\\\"$context\\\")].context.namespace}\" 2\u003e /dev/null)\"\n\nfunctions/geometry_hg.zsh\n7:  local branch=\"$(ansi ${GEOMETRY_HG_COLOR_BRANCH:=242} $(hg branch 2\u003e /dev/null))\"\n10:    \u0026\u0026 local symbol=$(ansi ${GEOMETRY_HG_COLOR_DIRTY:=red} ${GEOMETRY_HG_SYMBOL_DIRTY:=\"⬡\"}) \\\n11:    || local symbol=$(ansi ${GEOMETRY_HG_COLOR_CLEAN:=green} ${GEOMETRY_HG_SYMBOL_CLEAN:=\"⬢\"})\n\nfunctions/geometry_rust_version.zsh\n6:      local rust_version=$(rustc --version | \\grep --color=never -oE '[0-9]+\\.[0-9]+\\.[0-9]')\n\nfunctions/geometry_git.zsh\n55:  local_commit=$(git rev-parse \"@\" 2\u003e/dev/null)\n\nfunctions/geometry_status.zsh\n20:    local sum=0; for c in ${(s::)^HOST}; do ((sum += $(print -f '%d' \"'$c\"))); done\n22:    local index=$(($sum % ${#colors}))\n\nfunctions/geometry_npm_package_version.zsh\n10:     local npm_package_version=$(\\grep version package.json | \\grep --color=never -oE '[0-9]+\\.[0-9]+\\.[0-9]')\n12:    local symbol=$(ansi $GEOMETRY_NPM_PACKAGE_VERSION_SYMBOL_COLOR $GEOMETRY_NPM_PACKAGE_SYMBOL)\n13:    local version=$(ansi $GEOMETRY_NPM_PACKAGE_VERSION_COLOR v$npm_package_version)\n```","files":null},{"type":6,"author":{"id":"33950328296720bc91f2399d6dc2e05aaa877cba"},"timestamp":1567270260,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDI3MTYxODQ5Ng=="},"target":"c9b57419241a9e9992aa8a3b541335fcbc2b8df421d58d87f49c51889be341ee","message":"So the `local var=$( ... )` should be changed to a quoted version `local var=\"$( ... )\"`. I did a quick search and found a few of such cases:\n\n```\n ▲ .zplugin/plugins/geometry-zsh---geometry ack local.\\*'[^\"]\\$\\('     mnml 9d :: ⬡\nfunctions/geometry_hg.zsh\n7:  local branch=\"$(ansi ${GEOMETRY_HG_COLOR_BRANCH:=242} $(hg branch 2\u003e /dev/null))\"\n10:    \u0026\u0026 local symbol=$(ansi ${GEOMETRY_HG_COLOR_DIRTY:=red} ${GEOMETRY_HG_SYMBOL_DIRTY:=\"⬡\"}) \\\n11:    || local symbol=$(ansi ${GEOMETRY_HG_COLOR_CLEAN:=green} ${GEOMETRY_HG_SYMBOL_CLEAN:=\"⬢\"})\n\nfunctions/geometry_rust_version.zsh\n6:      local rust_version=$(rustc --version | \\grep --color=never -oE '[0-9]+\\.[0-9]+\\.[0-9]')\n\nfunctions/geometry_git.zsh\n55:  local_commit=$(git rev-parse \"@\" 2\u003e/dev/null)\n\nfunctions/geometry_status.zsh\n20:    local sum=0; for c in ${(s::)^HOST}; do ((sum += $(print -f '%d' \"'$c\"))); done\n22:    local index=$(($sum % ${#colors}))\n\nfunctions/geometry_npm_package_version.zsh\n10:     local npm_package_version=$(\\grep version package.json | \\grep --color=never -oE '[0-9]+\\.[0-9]+\\.[0-9]')\n12:    local symbol=$(ansi $GEOMETRY_NPM_PACKAGE_VERSION_SYMBOL_COLOR $GEOMETRY_NPM_PACKAGE_SYMBOL)\n13:    local version=$(ansi $GEOMETRY_NPM_PACKAGE_VERSION_COLOR v$npm_package_version)\n```","files":null},{"type":6,"author":{"id":"33950328296720bc91f2399d6dc2e05aaa877cba"},"timestamp":1567270340,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDI3MTYxODY4MQ=="},"target":"c9b57419241a9e9992aa8a3b541335fcbc2b8df421d58d87f49c51889be341ee","message":"So the `local var=$( ... )` should be changed to a quoted version `local var=\"$( ... )\"`. I did a quick search and found a few of such cases:\n\n```\n ▲ .zplugin/plugins/geometry-zsh---geometry ack local.\\*'[^\"]\\$\\('     mnml 9d :: ⬡\nfunctions/geometry_hg.zsh\n7:  local branch=\"$(ansi ${GEOMETRY_HG_COLOR_BRANCH:=242} $(hg branch 2\u003e /dev/null))\"\n10:    \u0026\u0026 local symbol=$(ansi ${GEOMETRY_HG_COLOR_DIRTY:=red} ${GEOMETRY_HG_SYMBOL_DIRTY:=\"⬡\"}) \\\n11:    || local symbol=$(ansi ${GEOMETRY_HG_COLOR_CLEAN:=green} ${GEOMETRY_HG_SYMBOL_CLEAN:=\"⬢\"})\n\nfunctions/geometry_rust_version.zsh\n6:      local rust_version=$(rustc --version | \\grep --color=never -oE '[0-9]+\\.[0-9]+\\.[0-9]')\n\nfunctions/geometry_git.zsh\n55:  local_commit=$(git rev-parse \"@\" 2\u003e/dev/null)\n\nfunctions/geometry_status.zsh\n20:    local sum=0; for c in ${(s::)^HOST}; do ((sum += $(print -f '%d' \"'$c\"))); done\n22:    local index=$(($sum % ${#colors}))\n\nfunctions/geometry_npm_package_version.zsh\n10:     local npm_package_version=$(\\grep version package.json | \\grep --color=never -oE '[0-9]+\\.[0-9]+\\.[0-9]')\n12:    local symbol=$(ansi $GEOMETRY_NPM_PACKAGE_VERSION_SYMBOL_COLOR $GEOMETRY_NPM_PACKAGE_SYMBOL)\n13:    local version=$(ansi $GEOMETRY_NPM_PACKAGE_VERSION_COLOR v$npm_package_version)\n```\n\nZsh 5.0 is now 7 years old, but maybe it's worth to fix this.","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1570294399,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUzODY2NzQ3NA==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-538667474"},"message":"I'm not sure I can fix line 20 of geometry_status, because of the quotes in quotes. Will zsh understand\n`sum += \"$(print -f '%d' \"'$c\")\"`?","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1570294759,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUzODY2ODAwNA==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-538668004"},"message":"Quoted profusely in https://github.com/geometry-zsh/geometry/commit/75b6a1bfbb5339d59bb6f3d317a1a54b195455df","files":null},{"type":4,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1570294759,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MjY4OTQwOTg4MA=="},"status":2},{"type":3,"author":{"id":"33950328296720bc91f2399d6dc2e05aaa877cba"},"timestamp":1570295922,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUzODY3MDA1Mg==","github-url":"https://github.com/geometry-zsh/geometry/issues/246#issuecomment-538670052"},"message":"Yes I think that Zsh properly understands such embedded quoting.","files":null}]}