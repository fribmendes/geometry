{"version":1,"ops":[{"type":6,"author":{"id":"2ec35aab1ba61831bd285feb3d0b9192a545fff4"},"timestamp":1571641770,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDI5NTg1NjIwMQ=="},"target":"c8a646103380e80524dfdf275e1c9e67b67dc816fe3b13095ee8c46d26c91406","message":"I've just started using geometry against the mnml branch and have found that even with `geometry_exec_time` in a prompt, it doesn't actually show for long running commands.\n\nI don't know much about the internals of ZSH, but I think I've narrowed it down to the fact that the `time_command_begin` function doesn't fire (the preexec hook doesn't seem to load it). Further testing leads me to believe that this is caused by #273 because if I copy the appropriate few lines from the function file into `geometry.zsh`, it works.","files":null},{"type":3,"author":{"id":"33995c4d01b73713061146492fa691fa8865ada5"},"timestamp":1571669870,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0NDU1NDI2OQ==","github-url":"https://github.com/geometry-zsh/geometry/issues/278#issuecomment-544554269"},"message":"It's caused by the `autoload -Uk` flag which we opted for instead of the changes in #273. Since all ZSH hooks are evaluated in subshells due to the lazy loading, the top-level shell will never initialize the hooks. We're discussing in #272, and I think we're likely to revert the lazy loading for now until we can find a working approach to do it. For now you can change the line `autoload -Uk $fun` in `geometry.zsh` back to `. $fun` for a temporary fix... here's the diff:\n\n```diff\ndiff --git a/geometry.zsh b/geometry.zsh\nindex dc4942d..f1f066d 100644\n--- a/geometry.zsh\n+++ b/geometry.zsh\n@@ -12,7 +12,7 @@ typeset -gA GEOMETRY; GEOMETRY[ROOT]=${0:A:h}\n\n autoload -U add-zsh-hook\n\n-function { local fun; for fun (\"${GEOMETRY[ROOT]}\"/functions/*) autoload -Uk $fun }\n+function { local fun; for fun (\"${GEOMETRY[ROOT]}\"/functions/*) . $fun }\n\n (( $+functions[ansi] )) || ansi() { (($# - 2)) || echo -n \"%F{$1}$2%f\"; }\n```\n\nSorry for the inconvenience. The changes will most likely be pushed today.","files":null},{"type":3,"author":{"id":"940aabe64f74a4490b5129922ab6d0d7b9926a38"},"timestamp":1571673612,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0NDU4MjkzMg==","github-url":"https://github.com/geometry-zsh/geometry/issues/278#issuecomment-544582932"},"message":"yeah we should switch back from lazy loading, I thought I tested exec_time but I guess I didn't.\n\n\nThanks for the report @barnsza and sorry for breaking it!","files":null},{"type":4,"author":{"id":"33995c4d01b73713061146492fa691fa8865ada5"},"timestamp":1571678084,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MjczMDUyMjEzNQ=="},"status":2}]}