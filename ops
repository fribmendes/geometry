{"version":1,"ops":[{"type":5,"author":{"id":"d4eb9eb05c8e7e760e59ab8c578fae019321a3fc"},"timestamp":1486661951,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDk1NTk5NTgxNg=="},"added":["bug"],"removed":[]},{"type":5,"author":{"id":"d4eb9eb05c8e7e760e59ab8c578fae019321a3fc"},"timestamp":1486662203,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDk1NjAwMzQ1MA=="},"added":["easy"],"removed":[]},{"type":5,"author":{"id":"d4eb9eb05c8e7e760e59ab8c578fae019321a3fc"},"timestamp":1486662203,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDk1NjAwMzQ1MQ=="},"added":["help wanted"],"removed":[]},{"type":3,"author":{"id":"d031c473ea44f2997770f844cf5bd248db34a431"},"timestamp":1486667786,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI3ODc0MzAxNQ==","github-url":"https://github.com/geometry-zsh/geometry/issues/114#issuecomment-278743015"},"message":"`$UID` is a great option IMO.","files":null},{"type":3,"author":{"id":"d337f10abe96470e0a3a86bfeb0ada25355648d2"},"timestamp":1489534457,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI4NjU5NTIxNg==","github-url":"https://github.com/geometry-zsh/geometry/issues/114#issuecomment-286595216"},"message":"So I hit this today when trying out geometry for the first time. \n\nAfter debugging for a bit I ended up with a slightly different solution which was to both make the `rm` forceful and add a graceful exit hook to clean up of the temp file.\n\n```diff\ndiff --git a/lib/async.zsh b/lib/async.zsh\nindex 01d4d68..5e1134f 100644\n--- a/lib/async.zsh\n+++ b/lib/async.zsh\n@@ -23,12 +23,18 @@ typeset -g GEOMETRY_ASYNC_PROC_ID=0\n     GEOMETRY_ASYNC_PROC_ID=$!\n }\n\n+# Clean up the async temp file when zsh exits\n+-geometry_async_zshexit() {\n+    rm -f \"${GEOMETRY_ASYNC_TMP_FULL_PATH}$$\"\n+}\n+\n # Hooks precmd to run `-geometry_async_function` and hooks\n # `USR1` signal to comunicate with it\n geometry_async_setup() {\n     add-zsh-hook precmd '-geometry_async_precmd'\n\n-    (\\rm ${GEOMETRY_ASYNC_TMP_FULL_PATH}*) \u0026\u003e /dev/null\n+    add-zsh-hook zshexit '-geometry_async_zshexit'\n+    \\rm -f ${GEOMETRY_ASYNC_TMP_FULL_PATH}* \u0026\u003e /dev/null\n\n     TRAPUSR1() {\n         # read from temp file\n```\n\nI ran into particular difficulty debugging the hang after enabling trace because the `rm` was being run in a subshell. So I removed that as well.\n\nI'd be happy to open a PR that uses some combination of the proposed options to resolve this issue but would like some advice on which of the above to implement. I'm currently using the forceful rm + hook locally and it seems to be working out.","files":null},{"type":3,"author":{"id":"d4eb9eb05c8e7e760e59ab8c578fae019321a3fc"},"timestamp":1489592028,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI4Njc4MDE1NQ==","github-url":"https://github.com/geometry-zsh/geometry/issues/114#issuecomment-286780155"},"message":"I like the idea of `zshexit` hook, if it works then let's use it. We can even get rid of `rm` in `geometry_async_setup`!\n\nLet's go for it! @thomaso-mirodin","files":null},{"type":3,"author":{"id":"d031c473ea44f2997770f844cf5bd248db34a431"},"timestamp":1489617798,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDI4NjkwMjkzOA==","github-url":"https://github.com/geometry-zsh/geometry/issues/114#issuecomment-286902938"},"message":"Oooh, this is nice. Nice solution. By looking at the diff, and this is me getting ahead of code review, if you see yourself using `\\rm -f ${GEOMETRY_ASYNC_TMP_FULL_PATH}* \u0026\u003e /dev/null` more than once, consider extracting it to a separate function.\n\nAll in all, this is nice, open up a PR.","files":null},{"type":4,"author":{"id":"d031c473ea44f2997770f844cf5bd248db34a431"},"timestamp":1490178624,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTAxMDE3NzM4OQ=="},"status":2}]}